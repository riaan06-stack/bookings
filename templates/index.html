<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>INWMH Studios | Book Your Session</title>

    <style>
        /* ---------- Base / Reset ---------- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: Inter, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #1e293b;
        }

        .container {
            width: 100%;
            max-width: 1000px
        }

        header {
            text-align: center;
            margin-bottom: 32px
        }

        header h1 {
            color: #fff;
            font-size: 2.6rem;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, .5);
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #cbd5e1;
            font-weight: 300;
            margin-top: 8px;
            font-size: 1.1rem
        }

        .form-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(51, 65, 85, 0.95));
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 34px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, .4);
            border: 1px solid rgba(96, 165, 250, 0.2);
        }

        /* ---------- Progress ---------- */
        .progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 28px;
            position: relative
        }

        .progress::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e2e8f0;
            z-index: 1
        }

        .step {
            flex: 1;
            text-align: center;
            font-size: .85rem;
            color: #94a3b8;
            position: relative;
            z-index: 2;
            transition: all .3s
        }

        .step::before {
            content: "";
            display: block;
            width: 36px;
            height: 36px;
            background: #e2e8f0;
            border-radius: 50%;
            margin: 0 auto 8px;
            border: 4px solid #fff;
            transition: all .3s
        }

        .step.active {
            color: #3b82f6;
            font-weight: 600
        }

        .step.active::before {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(59, 130, 246, .5);
        }

        /* ---------- Form sections ---------- */
        .form-section {
            display: none;
            animation: slideIn .35s ease
        }

        .form-section.active {
            display: block
        }

        h2 {
            font-size: 1.6rem;
            margin-bottom: 18px;
            color: #f1f5f9;
            font-weight: 600
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 14px;
            border-radius: 10px;
            border: 2px solid rgba(100, 116, 139, 0.3);
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            font-size: 1rem;
            transition: all .25s;
        }

        input::placeholder,
        select,
        textarea::placeholder {
            color: #94a3b8;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(15, 23, 42, 0.8);
            box-shadow: 0 8px 20px rgba(59, 130, 246, .25);
            transform: translateY(-1px);
        }

        textarea {
            min-height: 110px;
            resize: vertical
        }

        .button-row {
            display: flex;
            gap: 12px;
            margin-top: 8px
        }

        .prev {
            flex: 1;
            background: rgba(30, 41, 59, 0.8);
            color: #cbd5e1;
            border: 2px solid rgba(100, 116, 139, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all .25s;
        }

        .prev:hover {
            background: rgba(51, 65, 85, 0.9);
            border-color: rgba(100, 116, 139, 0.5);
            transform: translateY(-2px);
        }

        .next,
        .submit-btn {
            flex: 1;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all .25s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, .3);
        }

        .next:hover,
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, .4);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .submit-btn.loading {
            position: relative;
            color: transparent;
        }

        .submit-btn.loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(16px)
            }

            to {
                opacity: 1;
                transform: none
            }
        }

        /* Setup options */
        .setup-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 14px;
            margin-bottom: 18px
        }

        .setup-card {
            border: 2px solid rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            background: rgba(15, 23, 42, 0.6);
            cursor: pointer;
            transition: all .3s;
        }

        .setup-card img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 8px;
            display: block
        }

        .setup-card span {
            font-weight: 600;
            color: #e2e8f0
        }

        .setup-card input {
            display: none
        }

        .setup-card:hover {
            transform: translateY(-6px);
            border-color: #3b82f6;
            box-shadow: 0 8px 24px rgba(59, 130, 246, .15);
        }

        .setup-card:has(input:checked) {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            box-shadow: 0 8px 24px rgba(59, 130, 246, .3);
        }

        /* Package cards */
        .package-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 16px
        }

        .package-card {
            position: relative;
            border: 3px solid rgba(100, 116, 139, 0.3);
            border-radius: 18px;
            padding: 22px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8));
            cursor: pointer;
            transition: all .3s;
            display: flex;
            flex-direction: column;
            min-height: 220px;
        }

        .package-card input {
            display: none
        }

        .package-card:hover {
            transform: translateY(-8px);
            border-color: #3b82f6;
            box-shadow: 0 20px 45px rgba(59, 130, 246, .3);
        }

        .package-card:has(input:checked) {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-color: #3b82f6;
            box-shadow: 0 20px 45px rgba(59, 130, 246, .4);
        }

        .package-card h3 {
            font-size: 1.2rem;
            margin-bottom: 6px;
            color: #f1f5f9
        }

        .badge {
            position: absolute;
            top: -12px;
            left: 18px;
            padding: 8px 14px;
            border-radius: 12px;
            font-weight: 700;
            color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .2)
        }

        .badge.best {
            background: linear-gradient(135deg, #8b5cf6, #ec4899)
        }

        .badge.exclusive {
            background: linear-gradient(135deg, #f59e0b, #eab308);
            color: #1e293b
        }

        /* People selector */
        .people-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 12px
        }

        .person-icon {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.6);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
            transition: all .3s;
        }

        .person-icon span {
            position: relative;
            z-index: 1;
            font-size: 1.4rem;
            filter: grayscale(1)
        }

        .person-number {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: #fff;
            color: #3b82f6;
            font-size: .7rem;
            font-weight: 700;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(.6);
            transition: all .25s;
        }

        .person-icon.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, .3);
        }

        .person-icon.active span {
            filter: none;
            filter: brightness(1.3)
        }

        .person-icon.active .person-number {
            opacity: 1;
            transform: scale(1)
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 10px
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8));
            cursor: pointer;
            border: 2px solid transparent;
            font-weight: 700;
            color: #e2e8f0;
            transition: all .25s;
        }

        .calendar-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, .15);
            border-color: rgba(59, 130, 246, .2);
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, .35);
        }

        .calendar-day.past-date {
            background: rgba(51, 65, 85, 0.4);
            color: #64748b;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .calendar-day.sunday {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .calendar-day.saturday {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #fff;
            position: relative;
        }

        .calendar-day.saturday::after {
            content: "üí∞";
            position: absolute;
            bottom: 4px;
            right: 4px;
            font-size: 0.7rem;
        }

        .calendar-day.past-date:hover,
        .calendar-day.sunday:hover {
            transform: none;
            box-shadow: none;
            border-color: transparent
        }

        /* Timeslots */
        .timeslot-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px
        }

        .timeslot {
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8));
            border: 2px solid rgba(59, 130, 246, .2);
            font-weight: 700;
            color: #e2e8f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all .25s;
        }

        .timeslot:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, .15);
            border-color: rgba(59, 130, 246, .3);
        }

        .timeslot.selected {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            border-color: #3b82f6;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(59, 130, 246, .3);
        }

        .timeslot.booked {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
            border-color: #dc2626;
            cursor: not-allowed;
            opacity: .9;
            pointer-events: none;
        }

        .timeslot.blocked {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #fff;
            border-color: #c2410c;
            cursor: not-allowed;
            opacity: 0.8;
            pointer-events: none;
            position: relative;
            transform: none !important;
            box-shadow: none !important;
        }

        .timeslot.blocked::after {
            content: "Blocked";
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        /* Duration selector */
        .duration-selector {
            margin-top: 20px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .duration-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .duration-option {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.25s;
            border: 2px solid transparent;
        }

        .duration-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, .15);
            border-color: rgba(59, 130, 246, .2);
        }

        .duration-option.selected {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, .3);
        }

        /* Price display */
        .price-display {
            margin-top: 15px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            display: none;
        }

        .price-display.active {
            display: block;
        }

        .price-breakdown {
            background: rgba(30, 41, 59, 0.8);
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
        }

        .price-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .price-item.total {
            font-weight: 700;
            font-size: 1.1rem;
            color: #f1f5f9;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid rgba(59, 130, 246, 0.3);
        }

        .saturday-surcharge {
            color: #f59e0b;
            font-weight: 600;
        }

        /* Messages */
        .success-message,
        .error-message {
            display: none;
            padding: 14px;
            border-radius: 10px;
            margin-top: 14px;
            text-align: center;
            font-weight: 600
        }

        .success-message {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #fff;
            border: 2px solid #059669
        }

        .error-message {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            color: #dc2626;
            border: 2px solid #ef4444
        }

        /* Popup */
        #thankYouPopup {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, .7);
            backdrop-filter: blur(6px);
            z-index: 9999;
            align-items: center;
            justify-content: center
        }

        #thankYouBox {
            background: #fff;
            padding: 28px;
            border-radius: 14px;
            max-width: 420px;
            width: 92%;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0, 0, 0, .4);
            border: 1px solid rgba(59, 130, 246, .2);
        }

        #thankYouBox h2 {
            margin-bottom: 8px;
            color: #1e293b
        }

        #thankYouBox p {
            color: #64748b;
            line-height: 1.6
        }

        #thankYouBox button {
            margin-top: 16px;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            cursor: pointer;
            font-weight: 700;
            transition: all .25s;
        }

        #thankYouBox button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, .4)
        }

        .admin-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: #fff;
            padding: 12px 22px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0px 8px 20px rgba(59, 130, 246, 0.3);
            transition: 0.25s ease-in-out;
            z-index: 2000;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            transform: translateY(-3px);
            box-shadow: 0px 12px 28px rgba(59, 130, 246, 0.4);
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            color: #e2e8f0;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            border-color: #3b82f6;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        .control-btn:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .control-btn:disabled:hover {
            transform: none;
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .control-display {
            min-width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            color: #e2e8f0;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8));
            border-radius: 12px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .control-display:hover {
            border-color: #3b82f6;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 20px rgba(59, 130, 246, 0.2);
        }

        /* Selected slot visualization */
        .timeslot.part-of-selection {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(139, 92, 246, 0.4));
            border: 2px dashed #3b82f6;
            opacity: 0.7;
        }

        /* Package card additional styles */
        .package-subtitle {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-bottom: 12px;
            line-height: 1.4;
            min-height: 40px;
        }

        .package-card .price {
            font-size: 1.8rem;
            font-weight: 700;
            color: #60a5fa;
            margin: 12px 0;
        }

        .package-card .old-price {
            text-decoration: line-through;
            color: #94a3b8;
            font-size: 1rem;
            margin-top: 8px;
        }

        .package-card .save {
            color: #10b981;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .package-card .features {
            list-style: none;
            padding-left: 0;
            margin-top: 15px;
            flex-grow: 1;
        }

        .package-card .features li {
            padding: 4px 0;
            color: #cbd5e1;
            font-size: 0.85rem;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .package-card .features li::before {
            content: "‚úì";
            color: #10b981;
            font-weight: bold;
        }

        /* People selector additional styles */
        .selected-display {
            text-align: center;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .selected-number {
            font-size: 3.5rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .selected-text {
            font-size: 1rem;
            color: #94a3b8;
            font-weight: 500;
        }

        /* Calendar button fixes */
        .cal-btn {
            padding: 10px 14px !important;
            border-radius: 10px !important;
            border: 2px solid rgba(59, 130, 246, 0.3) !important;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8)) !important;
            cursor: pointer !important;
            font-weight: 700 !important;
            color: #60a5fa !important;
            min-width: 44px !important;
            transition: all 0.25s !important;
        }

        .cal-btn:hover {
            border-color: #3b82f6 !important;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2)) !important;
            transform: translateY(-2px) !important;
        }

        /* Review section fixes */
        #reviewDetails {
            background: rgba(15, 23, 42, 0.6) !important;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        #reviewDetails h3 {
            margin-bottom: 15px;
            color: #f1f5f9 !important;
        }

        #reviewContent div {
            color: #e2e8f0;
        }

        #reviewContent div strong {
            color: #cbd5e1;
        }

        @media (max-width:1024px) {
            .package-grid {
                grid-template-columns: repeat(2, 1fr)
            }

            .people-grid {
                grid-template-columns: repeat(6, 1fr)
            }
        }

        @media (max-width:768px) {
            .package-grid {
                grid-template-columns: 1fr
            }

            .people-grid {
                grid-template-columns: repeat(5, 1fr)
            }

            header h1 {
                font-size: 1.9rem
            }
        }

        @media (max-width:480px) {
            .people-grid {
                grid-template-columns: repeat(4, 1fr)
            }

            .selected-number {
                font-size: 2rem
            }
        }
    </style>
</head>

<body>

    <a href="/login" class="admin-btn">Admin Panel</a>

    <div class="container">
        <header>
            <h1>Reserve Your Studio Space</h1>
            <p class="subtitle">Book your professional recording session at INWMH Studios</p>
        </header>

        <div class="form-container">
            <div class="progress">
                <div class="step active">1. Personal</div>
                <div class="step">2. Setup</div>
                <div class="step">3. Package</div>
                <div class="step">4. Timing</div>
                <div class="step">5. Review</div>
            </div>

            <form id="reservationForm" novalidate>

                <!-- SECTION 1 -->
                <div class="form-section active">
                    <h2>Personal Details</h2>

                    <input type="text" name="name" placeholder="Full Name" required>
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="text" name="phone" placeholder="Phone" required>
                    <input type="text" name="company" placeholder="Company (optional)">

                    <div class="button-row">
                        <div style="flex:1"></div>
                        <button type="button" class="next">Next</button>
                    </div>
                </div>

                <!-- SECTION 2 -->
                <div class="form-section">
                    <h2>Studio Setup</h2>

                    <div class="setup-options">
                        <label class="setup-card">
                            <input type="radio" name="setup" value="The Nexus Setup" required>
                            <img src="https://via.placeholder.com/150x100/3b82f6/ffffff?text=Nexus+Setup" alt="Nexus Setup">
                            <span>The Nexus Setup</span>
                        </label>

                        <label class="setup-card">
                            <input type="radio" name="setup" value="The Duality Setup" required>
                            <img src="https://via.placeholder.com/150x100/8b5cf6/ffffff?text=Duality+Setup" alt="Duality Setup">
                            <span>The Duality Setup</span>
                        </label>

                        <label class="setup-card">
                            <input type="radio" name="setup" value="The Sync Setup" required>
                            <img src="https://via.placeholder.com/150x100/10b981/ffffff?text=Sync+Setup" alt="Sync Setup">
                            <span>The Sync Setup</span>
                        </label>

                        <label class="setup-card">
                            <input type="radio" name="setup" value="The Halo Setup" required>
                            <img src="https://via.placeholder.com/150x100/ec4899/ffffff?text=Halo+Setup" alt="Halo Setup">
                            <span>The Halo Setup</span>
                        </label>
                    </div>

                    <label style="display:block;font-weight:700;margin-bottom:10px;color:#e2e8f0">How many
                        people?</label>

                    <div class="people-selector-container">
                        <div class="selected-display">
                            <div class="selected-number" id="displayNumber">1</div>
                            <div class="selected-text" id="displayText">Person Selected</div>
                        </div>

                        <div class="people-grid" id="gridView"></div>

                        <div class="controls">
                            <button type="button" class="control-btn" id="decreaseBtn">‚àí</button>
                            <div class="control-display" id="controlDisplay">1</div>
                            <button type="button" class="control-btn" id="increaseBtn">+</button>
                        </div>

                        <input type="hidden" name="people" id="peopleInput" value="1">
                    </div>

                    <div class="button-row">
                        <button type="button" class="prev">Previous</button>
                        <button type="button" class="next">Next</button>
                    </div>
                </div>

                <!-- SECTION 3 -->
                <div class="form-section">
                    <h2>Package Selection</h2>

                    <div class="package-grid">
                        <label class="package-card">
                            <input type="radio" name="package" value="Recording + Live Mix" data-price="156" required>
                            <h3>Recording + Live Mix</h3>
                            <p class="package-subtitle">Ideal for immediate publishing in horizontal format.</p>
                            <div class="price">$156.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <ul class="features">
                                <li>‚úì Fully equipped Podcast Set of your choice</li>
                                <li>‚úì Studio operator to record everything for you</li>
                            </ul>
                        </label>

                        <label class="package-card">
                            <div class="badge best">‚ö° Best Buy</div>
                            <input type="radio" name="package" value="Recording + Professional Edit" data-price="276" required>
                            <h3>Recording + Professional Edit</h3>
                            <p class="package-subtitle">Perfect for a polished and professional finish.</p>
                            <div class="old-price">$312.00</div>
                            <div class="price">$276.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <div class="save">Save $36.00</div>
                            <ul class="features">
                                <li>‚úì Dedicated podcast producer to edit your episode</li>
                            </ul>
                        </label>

                        <label class="package-card">
                            <input type="radio" name="package" value="Recording" data-price="120" required>
                            <h3>Recording</h3>
                            <p class="package-subtitle">For raw footage you can edit later.</p>
                            <div class="price">$120.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <ul class="features">
                                <li>‚úì Raw footage backup for 14 days</li>
                            </ul>
                        </label>

                        <label class="package-card">
                            <input type="radio" name="package" value="Live Stream" data-price="138" required>
                            <h3>Live Stream</h3>
                            <p class="package-subtitle">Perfect for seamless and professional live streaming.</p>
                            <div class="price">$138.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <ul class="features">
                                <li>‚úì Live cutting with synced audio</li>
                            </ul>
                        </label>

                        <label class="package-card">
                            <input type="radio" name="package" value="Audio Only Recording" data-price="108" required>
                            <h3>Audio Only Recording</h3>
                            <p class="package-subtitle">Great for audio-only podcast production.</p>
                            <div class="price">$108.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <ul class="features">
                                <li>‚úì Multi-track recording</li>
                            </ul>
                        </label>

                        <label class="package-card">
                            <div class="badge exclusive">üî• Exclusive</div>
                            <input type="radio" name="package" value="Exclusive Event Space" data-price="360" required>
                            <h3>Exclusive Event Space</h3>
                            <p class="package-subtitle">Live audience podcasting, workshops & more.</p>
                            <div class="old-price">$480.00</div>
                            <div class="price">$360.00 <span style="font-size:.8rem;color:#64748b">/ per hour</span>
                            </div>
                            <div class="save">Save $120.00</div>
                            <ul class="features">
                                <li>‚úì 4x Shure SM7B mics</li>
                            </ul>
                        </label>
                    </div>

                    <div class="button-row">
                        <button type="button" class="prev">Previous</button>
                        <button type="button" class="next">Next</button>
                    </div>
                </div>

                <!-- SECTION 4 -->
                <div class="form-section">
                    <h2>Timing</h2>

                    <div class="calendar-container">
                        <div class="calendar-header"
                            style="display:flex;align-items:center;gap:12px;margin-bottom:12px;border-bottom:2px solid #e2e8f0;padding-bottom:10px">
                            <button id="prevMonth" class="cal-btn">&lt;</button>
                            <div id="calendarMonth"
                                style="flex:1;text-align:center;font-size:1.2rem;font-weight:700;color:#f1f5f9">Month
                            </div>
                            <button id="nextMonth" class="cal-btn">&gt;</button>
                        </div>

                        <div class="calendar-grid">
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#3b82f6;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Mon</div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#3b82f6;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Tue</div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#3b82f6;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Wed</div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#3b82f6;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Thu</div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#3b82f6;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Fri</div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#f59e0b;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Sat<span style="font-size:.6rem;margin-left:2px">(+20%)</span></div>
                            <div class="day-label"
                                style="text-align:center;font-weight:700;color:#ef4444;font-size:.78rem;text-transform:uppercase;padding:8px 0">
                                Sun<span style="font-size:.6rem;margin-left:2px">(Closed)</span></div>
                        </div>

                        <div id="calendarDays" class="calendar-days-grid"
                            style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px"></div>
                    </div>

                    <div class="timeslot-container"
                        style="background:rgba(15, 23, 42, 0.5);padding:18px;border-radius:12px;border:1px solid rgba(100, 116, 139, 0.3);margin-top:14px">
                        <h3 id="selectedDateTitle" style="text-align:center;margin-bottom:12px;color:#e2e8f0">Select a
                            date</h3>
                        <div id="timeslotList" class="timeslot-list"></div>
                    </div>

                    <div class="duration-selector">
                        <h3 style="margin-bottom:10px;color:#e2e8f0">Duration</h3>
                        <p style="margin-bottom:10px;color:#94a3b8">How many hours would you like to book?</p>
                        <div class="duration-options">
                            <div class="duration-option" data-hours="2">2 hours</div>
                            <div class="duration-option" data-hours="3">3 hours</div>
                            <div class="duration-option" data-hours="4">4 hours</div>
                            <div class="duration-option" data-hours="6">6 hours</div>
                            <div class="duration-option" data-hours="8">8 hours</div>
                        </div>
                    </div>

                    <!-- Price Display -->
                    <div class="price-display" id="priceDisplay">
                        <h3 style="margin-bottom:10px;color:#e2e8f0">Price Breakdown</h3>
                        <div class="price-breakdown" id="priceBreakdown">
                            <!-- Price breakdown will be inserted here -->
                        </div>
                    </div>

                    <!-- hidden fields (not required in HTML) -->
                    <input type="hidden" name="date" id="selectedDateInput">
                    <input type="hidden" name="time_slot" id="selectedTimeInput">
                    <input type="hidden" name="duration" id="selectedDurationInput" value="2">
                    <input type="hidden" name="base_price" id="basePriceInput">
                    <input type="hidden" name="saturday_surcharge" id="saturdaySurchargeInput">
                    <input type="hidden" name="total_price" id="totalPriceInput">

                    <div class="button-row" style="margin-top:12px">
                        <button type="button" class="prev">Previous</button>
                        <button type="button" class="next">Next</button>
                    </div>
                </div>

                <!-- SECTION 5 -->
                <div class="form-section">
                    <h2>Review & Submit</h2>

                    <div id="reviewDetails">
                        <h3>Booking Summary</h3>
                        <div id="reviewContent"></div>
                    </div>

                    <textarea name="requirements" placeholder="Special requests"></textarea>

                    <select name="referral">
                        <option value="">How did you hear about us?</option>
                        <option>Friend</option>
                        <option>Social Media</option>
                        <option>Search Engine</option>
                        <option>Other</option>
                    </select>

                    <div class="button-row" style="margin-bottom:14px">
                        <button type="button" class="prev">Previous</button>
                        <div style="flex:1"></div>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBookingBtn">Submit Booking</button>
                    <div class="success-message" id="successMessage">‚úÖ Booking submitted successfully! Redirecting to payment...</div>
                    <div class="error-message" id="errorMessage">‚ùå Error submitting booking. Try again.</div>
                </div>
            </form>
        </div>
    </div>

    <!-- THANK YOU POPUP -->
    <div id="thankYouPopup">
        <div id="thankYouBox">
            <h2>Thank you! üéâ</h2>
            <p>Your booking has been submitted! Our team will connect with you shortly for confirmation.</p>
            <button onclick="closePopup()">Okay</button>
        </div>
    </div>

    <script>
        /* -----------------------
           Form Navigation & Utilities
        ------------------------*/
        const sections = document.querySelectorAll(".form-section");
        const steps = document.querySelectorAll(".step");
        const nextBtns = document.querySelectorAll(".next");
        const prevBtns = document.querySelectorAll(".prev");
        let current = 0;

        function showSection(i) {
            current = i;
            sections.forEach((sec, idx) => sec.classList.toggle("active", idx === current));
            steps.forEach((st, idx) => st.classList.toggle("active", idx <= current));

            // Update review section when showing section 5
            if (i === 4) {
                updateReviewSection();
            }
        }

        nextBtns.forEach(btn => btn.addEventListener("click", () => {
            if (current < sections.length - 1) current++;
            showSection(current);
        }));

        prevBtns.forEach(btn => btn.addEventListener("click", () => {
            if (current > 0) current--;
            showSection(current);
        }));

        /* -----------------------
           People Selector
        ------------------------*/
        let selectedPeople = 1;
        const maxPeople = 10;
        const gridView = document.getElementById('gridView');
        const displayNumber = document.getElementById('displayNumber');
        const displayText = document.getElementById('displayText');
        const decreaseBtn = document.getElementById('decreaseBtn');
        const increaseBtn = document.getElementById('increaseBtn');
        const controlDisplay = document.getElementById('controlDisplay');
        const peopleInput = document.getElementById('peopleInput');

        function initializeGrid() {
            gridView.innerHTML = '';
            for (let i = 1; i <= maxPeople; i++) {
                const personDiv = document.createElement('div');
                personDiv.className = 'person-icon';
                personDiv.dataset.number = i;

                const emoji = document.createElement('span');
                emoji.textContent = i === 1 ? 'üë§' : 'üë•';

                const badge = document.createElement('div');
                badge.className = 'person-number';
                badge.textContent = i;

                personDiv.appendChild(emoji);
                personDiv.appendChild(badge);

                personDiv.addEventListener('click', () => selectPeople(i));
                gridView.appendChild(personDiv);
            }
            updatePeople();
        }

        function selectPeople(num) {
            selectedPeople = num;
            updatePeople();
            animatePeople();
        }

        function updatePeople() {
            document.querySelectorAll('.person-icon').forEach((icon, idx) => {
                if (idx < selectedPeople) icon.classList.add('active'); else icon.classList.remove('active');
            });

            displayNumber.textContent = selectedPeople;
            displayText.textContent = selectedPeople === 1 ? 'Person Selected' : 'People Selected';
            controlDisplay.textContent = selectedPeople;
            peopleInput.value = selectedPeople;

            decreaseBtn.disabled = selectedPeople <= 1;
            increaseBtn.disabled = selectedPeople >= maxPeople;
        }

        function animatePeople() {
            displayNumber.style.transform = 'scale(1.2)';
            setTimeout(() => displayNumber.style.transform = 'scale(1)', 180);
        }

        decreaseBtn.onclick = () => { if (selectedPeople > 1) selectPeople(selectedPeople - 1); };
        increaseBtn.onclick = () => { if (selectedPeople < maxPeople) selectPeople(selectedPeople + 1); };

        initializeGrid();

        /* -----------------------
           Package Prices
        ------------------------*/
        const packagePrices = {
            "Recording + Live Mix": 156,
            "Recording + Professional Edit": 276,
            "Recording": 120,
            "Live Stream": 138,
            "Audio Only Recording": 108,
            "Exclusive Event Space": 360
        };

        const SATURDAY_SURCHARGE_PERCENT = 20; // 20% extra for Saturday
        let currentPackagePrice = 0;
        let isSaturday = false;

        // Listen for package selection
        document.querySelectorAll('input[name="package"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                currentPackagePrice = packagePrices[e.target.value] || 0;
                updatePriceDisplay();
            });
        });

        /* -----------------------
           Time Slot System for Multi-hour Duration (FULL HOURS ONLY)
        ------------------------*/
        const timeslots = [
            "10:00 AM", "11:00 AM",
            "12:00 PM", "1:00 PM", "2:00 PM",
            "3:00 PM", "4:00 PM", "5:00 PM",
            "6:00 PM"
        ];

        /* -----------------------
           Calendar & Timeslots
        ------------------------*/
        const calendarDays = document.getElementById("calendarDays");
        const calendarMonth = document.getElementById("calendarMonth");
        const selectedDateInput = document.getElementById("selectedDateInput");
        const selectedTimeInput = document.getElementById("selectedTimeInput");
        const selectedDateTitle = document.getElementById("selectedDateTitle");
        const timeslotList = document.getElementById("timeslotList");
        const priceDisplay = document.getElementById("priceDisplay");
        const priceBreakdown = document.getElementById("priceBreakdown");

        let currentDate = new Date();
        let bookedSlotsForSelectedDate = []; // This will store detailed booking info with duration

        function loadCalendar() {
            calendarDays.innerHTML = "";
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            calendarMonth.textContent = currentDate.toLocaleString("default", { month: "long", year: "numeric" });

            const firstDayIndex = new Date(year, month, 1).getDay(); // 0 (Sun) .. 6
            const firstDay = firstDayIndex === 0 ? 7 : firstDayIndex; // Monday-first shift

            for (let i = 1; i < firstDay; i++) {
                calendarDays.appendChild(document.createElement("div"));
            }

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time for accurate comparison

            for (let d = 1; d <= daysInMonth; d++) {
                const el = document.createElement("div");
                const dateObj = new Date(year, month, d);
                dateObj.setHours(0, 0, 0, 0);

                el.className = "calendar-day";
                el.textContent = d;

                // Check day of week
                const dayOfWeek = dateObj.getDay(); // 0 = Sunday, 6 = Saturday

                // Check if date is in the past
                if (dateObj < today) {
                    el.classList.add("past-date");
                } else if (dayOfWeek === 0) { // Sunday - closed
                    el.classList.add("sunday");
                    el.classList.add("past-date"); // Also mark as past to disable clicking
                } else if (dayOfWeek === 6) { // Saturday - extra charge
                    el.classList.add("saturday");
                    el.onclick = () => selectDate(year, month, d, el, true);
                } else {
                    el.onclick = () => selectDate(year, month, d, el, false);
                }

                calendarDays.appendChild(el);
            }
        }

        function selectDate(year, month, day, element, saturday = false) {
            document.querySelectorAll(".calendar-day").forEach(e => e.classList.remove("selected"));
            element.classList.add("selected");

            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            selectedDateInput.value = dateStr;
            isSaturday = saturday;

            const formatted = new Date(year, month, day).toLocaleDateString("default", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric"
            });
            
            if (saturday) {
                selectedDateTitle.textContent = `Available times for ${formatted} (+20% surcharge)`;
            } else {
                selectedDateTitle.textContent = `Available times for ${formatted}`;
            }

            // Fetch booked slots + off-day info from backend
            fetch(`/booked_slots?date=${encodeURIComponent(dateStr)}`)
                .then(res => res.json())
                .then(data => {
                    // Expecting data format: 
                    // { booked: [{startTime: "10:00 AM", duration: 2}, ...], off_day: false }
                    bookedSlotsForSelectedDate = data.booked || [];
                    if (data.off_day) {
                        timeslotList.innerHTML = "<div style='padding:12px;text-align:center;font-weight:600;color:#c62828;'>Studio is closed on this date.</div>";
                        selectedTimeInput.value = "";
                    } else {
                        loadTimeslots();
                    }
                })
                .catch(err => {
                    console.error("Error fetching booked slots:", err);
                    bookedSlotsForSelectedDate = [];
                    loadTimeslots();
                });

            // Update price display
            updatePriceDisplay();
        }

        function loadTimeslots() {
            timeslotList.innerHTML = "";
            selectedTimeInput.value = "";
            clearTimeSlotVisualization();

            timeslots.forEach((time, index) => {
                const t = document.createElement("div");
                t.className = "timeslot";
                t.textContent = time;
                t.dataset.index = index;
                t.title = time; // Tooltip

                // Check if this time slot is booked or blocked
                const bookingStatus = getBookingStatusForTimeSlot(time);

                if (bookingStatus.status === 'booked') {
                    t.classList.add("booked");
                    t.title = `Booked: ${bookingStatus.duration} hour booking starting at ${bookingStatus.startTime}`;
                } else if (bookingStatus.status === 'blocked') {
                    t.classList.add("blocked");
                    t.title = `Blocked: Part of ${bookingStatus.relatedDuration} hour booking starting at ${bookingStatus.startTime}`;
                } else {
                    // Available time slot
                    t.onclick = () => selectTimeSlot(time, t);
                }

                timeslotList.appendChild(t);
            });
        }

        function getBookingStatusForTimeSlot(time) {
            // Check each booking to see if this time slot is affected
            for (const booking of bookedSlotsForSelectedDate) {
                const startIndex = timeslots.indexOf(booking.startTime);
                if (startIndex === -1) continue;

                // For full hour slots: duration = number of hours
                const durationSlots = booking.duration; // Each hour = 1 slot
                const endIndex = startIndex + durationSlots - 1;

                const currentIndex = timeslots.indexOf(time);

                if (currentIndex >= startIndex && currentIndex <= endIndex) {
                    if (currentIndex === startIndex) {
                        return {
                            status: 'booked',
                            duration: booking.duration,
                            startTime: booking.startTime
                        };
                    } else {
                        return {
                            status: 'blocked',
                            relatedDuration: booking.duration,
                            startTime: booking.startTime
                        };
                    }
                }
            }

            return { status: 'available' };
        }

        function selectTimeSlot(time, element) {
            const duration = parseInt(selectedDurationInput.value);

            // Check if all required time slots are available
            const requiredSlots = getTimeSlotsForDuration(time, duration);
            const isAvailable = requiredSlots.every(slot => {
                const status = getBookingStatusForTimeSlot(slot);
                return status.status === 'available';
            });

            if (!isAvailable) {
                alert(`Sorry, ${duration}-hour booking starting at ${time} is not available. Some time slots are already booked.`);
                return;
            }

            // Clear previous visualization
            clearTimeSlotVisualization();

            // Highlight all time slots that would be booked
            document.querySelectorAll(".timeslot").forEach(el => el.classList.remove("selected"));

            // Add selected class to the main time slot
            element.classList.add("selected");

            // Visual feedback for all time slots that would be booked
            requiredSlots.forEach(slotTime => {
                const slotElement = document.querySelector(`.timeslot[data-index="${timeslots.indexOf(slotTime)}"]`);
                if (slotElement && slotElement !== element) {
                    slotElement.classList.add("part-of-selection");
                }
            });

            selectedTimeInput.value = time;
            
            // Update price display
            updatePriceDisplay();
        }

        function clearTimeSlotVisualization() {
            document.querySelectorAll(".timeslot").forEach(el => {
                el.classList.remove("selected");
                el.classList.remove("part-of-selection");
            });
        }

        function getTimeSlotsForDuration(startTime, durationHours) {
            const startIndex = timeslots.indexOf(startTime);
            if (startIndex === -1) return [];

            // For full hour slots: duration = number of slots needed
            const durationSlots = durationHours; // Each hour = 1 slot
            const requiredSlots = [];

            for (let i = 0; i < durationSlots; i++) {
                if (startIndex + i < timeslots.length) {
                    requiredSlots.push(timeslots[startIndex + i]);
                }
            }

            return requiredSlots;
        }

        // Price calculation and display
        function updatePriceDisplay() {
            const duration = parseInt(selectedDurationInput.value) || 0;
            const selectedPackage = document.querySelector('input[name="package"]:checked');
            
            if (!selectedPackage || duration === 0 || !selectedDateInput.value) {
                priceDisplay.classList.remove('active');
                return;
            }

            const basePricePerHour = currentPackagePrice;
            const baseTotal = basePricePerHour * duration;
            
            let surcharge = 0;
            let surchargeText = '';
            
            if (isSaturday) {
                surcharge = baseTotal * (SATURDAY_SURCHARGE_PERCENT / 100);
                surchargeText = `Saturday surcharge (${SATURDAY_SURCHARGE_PERCENT}%)`;
            }
            
            const totalPrice = baseTotal + surcharge;

            // Update hidden inputs
            document.getElementById('basePriceInput').value = baseTotal.toFixed(2);
            document.getElementById('saturdaySurchargeInput').value = surcharge.toFixed(2);
            document.getElementById('totalPriceInput').value = totalPrice.toFixed(2);

            // Display price breakdown
            priceBreakdown.innerHTML = `
                <div class="price-item">
                    <span>${selectedPackage.value} (${duration} hours @ $${basePricePerHour}/hr)</span>
                    <span>$${baseTotal.toFixed(2)}</span>
                </div>
                ${isSaturday ? `
                <div class="price-item saturday-surcharge">
                    <span>${surchargeText}</span>
                    <span>+$${surcharge.toFixed(2)}</span>
                </div>
                ` : ''}
                <div class="price-item total">
                    <span>Total</span>
                    <span>$${totalPrice.toFixed(2)}</span>
                </div>
            `;

            priceDisplay.classList.add('active');
        }

        document.getElementById("prevMonth").onclick = () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendar();
            selectedDateInput.value = "";
            selectedTimeInput.value = "";
            priceDisplay.classList.remove('active');
        };

        document.getElementById("nextMonth").onclick = () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendar();
            selectedDateInput.value = "";
            selectedTimeInput.value = "";
            priceDisplay.classList.remove('active');
        };

        loadCalendar();

        /* -----------------------
           Duration Selector
        ------------------------*/
        const durationOptions = document.querySelectorAll('.duration-option');
        const selectedDurationInput = document.getElementById('selectedDurationInput');

        durationOptions.forEach(option => {
            option.addEventListener('click', () => {
                durationOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedDurationInput.value = option.dataset.hours;

                // Clear any time slot selection when duration changes
                clearTimeSlotVisualization();
                selectedTimeInput.value = "";
                
                // Update price display
                updatePriceDisplay();
            });
        });

        // Set default duration
        durationOptions[0].classList.add('selected');

        /* -----------------------
           Review Section
        ------------------------*/
        function updateReviewSection() {
            const formData = new FormData(document.getElementById('reservationForm'));
            const reviewContent = document.getElementById('reviewContent');

            // Get values directly from form elements to ensure we have the actual data
            const name = document.querySelector('input[name="name"]')?.value || 'Not provided';
            const email = document.querySelector('input[name="email"]')?.value || 'Not provided';
            const phone = document.querySelector('input[name="phone"]')?.value || 'Not provided';
            const company = document.querySelector('input[name="company"]')?.value || 'Not provided';
            const setup = document.querySelector('input[name="setup"]:checked')?.value || 'Not selected';
            const people = document.querySelector('input[name="people"]')?.value || '1';
            const package = document.querySelector('input[name="package"]:checked')?.value || 'Not selected';
            const date = document.querySelector('input[name="date"]')?.value || 'Not selected';
            const time = document.querySelector('input[name="time_slot"]')?.value || 'Not selected';
            const duration = document.querySelector('input[name="duration"]')?.value || '2';
            const requirements = document.querySelector('textarea[name="requirements"]')?.value || 'None';
            const referral = document.querySelector('select[name="referral"]')?.value || 'Not specified';
            
            // Get price details
            const basePrice = document.getElementById('basePriceInput')?.value || '0.00';
            const saturdaySurcharge = document.getElementById('saturdaySurchargeInput')?.value || '0.00';
            const totalPrice = document.getElementById('totalPriceInput')?.value || '0.00';
            
            // Check if it's Saturday
            const dateObj = new Date(date);
            const isSaturdayBooking = date && date !== 'Not selected' ? new Date(date).getDay() === 6 : false;
            const dayType = isSaturdayBooking ? 'Saturday (+20% surcharge)' : 
                           dateObj.getDay() === 0 ? 'Sunday (Closed)' : 'Weekday';

            reviewContent.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div><strong>Name:</strong></div><div>${name}</div>
          <div><strong>Email:</strong></div><div>${email}</div>
          <div><strong>Phone:</strong></div><div>${phone}</div>
          <div><strong>Company:</strong></div><div>${company}</div>
          <div><strong>Setup:</strong></div><div>${setup}</div>
          <div><strong>People:</strong></div><div>${people}</div>
          <div><strong>Package:</strong></div><div>${package}</div>
          <div><strong>Date:</strong></div><div>${date} (${dayType})</div>
          <div><strong>Time:</strong></div><div>${time}</div>
          <div><strong>Duration:</strong></div><div>${duration} hours</div>
          ${isSaturdayBooking ? `<div><strong>Saturday Surcharge:</strong></div><div>+$${parseFloat(saturdaySurcharge).toFixed(2)} (20%)</div>` : ''}
          <div><strong>Total Price:</strong></div><div><strong>$${parseFloat(totalPrice).toFixed(2)}</strong></div>
          <div><strong>Special Requests:</strong></div><div>${requirements}</div>
          <div><strong>Referral:</strong></div><div>${referral}</div>
        </div>
      `;
        }

        /* -----------------------
           Submit validation + send
        ------------------------*/
        const form = document.getElementById("reservationForm");
        const submitBtn = document.getElementById("submitBookingBtn");
        const successMessage = document.getElementById("successMessage");
        const errorMessage = document.getElementById("errorMessage");

        function validateBeforeSubmit(data) {
            // data is a plain object from FormData
            if (!data.name || !data.email || !data.phone) {
                alert("Please fill in all required personal details (Name, Email, Phone).");
                showSection(0); // navigate user to Personal section
                return false;
            }
            if (!data.setup) {
                alert("Please select a studio setup before submitting.");
                showSection(1); // navigate user to Setup
                return false;
            }
            if (!data.package) {
                alert("Please select a package before submitting.");
                showSection(2); // go to Package
                return false;
            }
            // people should be > 0
            const peopleNum = Number(data.people || 0);
            if (!peopleNum || peopleNum < 1) {
                alert("Please choose how many people will attend the session.");
                showSection(1); // people selector is in Setup section
                return false;
            }
            if (!data.date) {
                alert("Please select a date for your booking.");
                showSection(3); // Timing section
                return false;
            }
            
            // Check if selected date is Sunday
            const selectedDate = new Date(data.date);
            if (selectedDate.getDay() === 0) {
                alert("Sorry, the studio is closed on Sundays. Please select another date.");
                showSection(3); // Timing section
                return false;
            }
            
            if (!data.time_slot) {
                alert("Please select a time slot for your booking.");
                showSection(3); // Timing section
                return false;
            }
            // all good
            return true;
        }

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Prevent double submission
            if (submitBtn.disabled) return;
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            
            successMessage.style.display = "none";
            errorMessage.style.display = "none";

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            if (!validateBeforeSubmit(data)) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                return;
            }

            const duration = parseInt(data.duration) || 2;
            const timeSlot = data.time_slot;

            const bookingInfo = {
                ...data,
                duration,
                bookedSlots: getTimeSlotsForDuration(timeSlot, duration),
                base_price: data.base_price || "0.00",
                saturday_surcharge: data.saturday_surcharge || "0.00",
                total_price: data.total_price || "0.00",
                is_saturday: isSaturday
            };

            try {
                const res = await fetch("/submit", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(bookingInfo)
                });

                if (res.ok) {
                    const result = await res.json();
                    successMessage.style.display = "block";
                    successMessage.textContent = "‚úÖ Booking submitted successfully! Redirecting to payment...";
                    
                    // IMPORTANT: Redirect to payment page with booking ID
                    if (result.booking_id) {
                        setTimeout(() => {
                            window.location.href = `/payment/${result.booking_id}`;
                        }, 1500);
                    } else {
                        showPopup();
                    }
                    
                    // Don't reset form here - let payment page handle it
                    return;
                } 
                else if (res.status === 409) {
                    const errorData = await res.json();
                    alert(errorData.message || "Selected slots overlap with an existing booking.");
                    errorMessage.style.display = "block";
                } 
                else {
                    const errorData = await res.json();
                    alert(errorData.message || "Error submitting booking. Please try again.");
                    errorMessage.style.display = "block";
                }
            } catch (err) {
                console.error("Submission error:", err);
                alert("Network error. Please check your connection and try again.");
                errorMessage.style.display = "block";
            } finally {
                // Only re-enable if not successful (no redirect happened)
                if (!successMessage.style.display || successMessage.style.display === "none") {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                }
            }
        });

        /* -----------------------
           Popup
        ------------------------*/
        function showPopup() {
            document.getElementById("thankYouPopup").style.display = "flex";
        }
        function closePopup() {
            document.getElementById("thankYouPopup").style.display = "none";
        }
    </script>
</body>
</html>
